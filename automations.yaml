- id: '1673726732766'
  alias: HW_heater_night_on
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /10
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: schedule.hw_night_heater
      state: 'on'
    - condition: state
      entity_id: input_boolean.hw_night_heater
      state: 'off'
    - condition: device
      type: is_off
      device_id: 2af4ef0f2bcda9a25e0f0bbf7ea493d2
      entity_id: switch.sonoff_10016da541
      domain: switch
  action:
  - type: turn_on
    device_id: 2af4ef0f2bcda9a25e0f0bbf7ea493d2
    entity_id: switch.sonoff_10016da541
    domain: switch
  - service: notify.notify
    data:
      message: HW night is on
  - service: input_boolean.turn_on
    data: {}
    target:
      entity_id: input_boolean.hw_night_heater
  mode: single
- id: '1673732606457'
  alias: Test_notification
  description: ''
  trigger:
  - platform: device
    device_id: c3a76d6de50c7686bd7051d3a21eee32
    domain: device_tracker
    entity_id: device_tracker.21091116ag
    type: enters
    zone: zone.home
  condition: []
  action:
  - service: notify.notify
    data:
      message: Pavlo at home
  mode: single
- id: '1674030397694'
  alias: Water_leaks
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: c52026eaf890fb585b64f5bb03bb6a4e
    entity_id: binary_sensor.bathroom_1_leak_water_leak
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - type: moist
    platform: device
    device_id: fd7758ab4ceb69d494f71c8430a000d6
    entity_id: binary_sensor.bathroom_2_leak_water_leak
    domain: binary_sensor
  - type: moist
    platform: device
    device_id: 7dd4b9ccf6518d201da4c30ed646185c
    entity_id: binary_sensor.technical_leak_water_leak
    domain: binary_sensor
    for:
      hours: 0
      minutes: 20
      seconds: 0
  condition: []
  action:
  - type: turn_off
    device_id: a6bf65abd239c30e7543eb30f291cfa2
    entity_id: switch.0xa4c1381766502901_left
    domain: switch
  - type: turn_off
    device_id: e0a8e8d356f5a6dfdf554f9e46c34dbf
    entity_id: switch.main_water
    domain: switch
  - type: turn_off
    device_id: 3080b9c89d9692d225fefa392b50bd23
    entity_id: switch.0x84fd27fffe927f0d
    domain: switch
  - type: turn_off
    device_id: 862a390e759b291bd94777c4dd62c07b
    entity_id: switch.0x804b50fffeb0d7fe
    domain: switch
  - service: notify.notify
    data:
      message: WATER LEAKS - WATER IS CLOSED
  mode: single
- id: '1674140911254'
  alias: HW_watter_night_off
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /10
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: schedule.hw_night_heater
      state: 'off'
    - condition: state
      entity_id: input_boolean.hw_night_heater
      state: 'on'
  action:
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.hw_night_heater
  - type: turn_off
    device_id: 2af4ef0f2bcda9a25e0f0bbf7ea493d2
    entity_id: switch.sonoff_10016da541
    domain: switch
  - service: notify.notify
    data:
      message: HW night is off
  mode: single
- id: '1674680920351'
  alias: Temp_control_restart
  description: Run check for proper restart after power off
  trigger:
  - platform: homeassistant
    event: start
  condition:
  - type: is_not_open
    condition: device
    device_id: 7bdeccb84efbc427478b0e98c475f391
    entity_id: binary_sensor.0x00124b0029120b77_contact
    domain: binary_sensor
  action:
  - delay:
      hours: 0
      minutes: 15
      seconds: 0
      milliseconds: 0
  - service: automation.trigger
    data: {}
    target:
      entity_id:
      - automation.temp_control_winter
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: automation.trigger
    data: {}
    target:
      entity_id:
      - automation.temp_control_spring
  mode: single
- id: '1677227078813'
  alias: irrigation_unlimited_counter_update
  description: Update counter of days in case max temp changed
  trigger:
  - platform: state
    entity_id:
    - sensor.irrigation_unlimited_counter
    for:
      hours: 0
      minutes: 30
      seconds: 0
  condition:
  - condition: template
    value_template: '{{int(states(''sensor.irrigation_unlimited_counter''),0) !=  int(states(''input_number.irrigation_counter_check''),0)}}'
  action:
  - service: input_number.set_value
    target:
      entity_id: input_number.irrigation_counter
    data:
      value: "{{ (states('sensor.irrigation_unlimited_counter') | float(0))  +\n    (states('input_number.irrigation_counter')
        | float(0))  -\n  (states('input_number.irrigation_counter_check') | float(0))
        }}"
    enabled: false
  - if:
    - condition: template
      value_template: "{{  (states('sensor.irrigation_unlimited_counter') | float(0))
        \ +\n        (states('input_number.irrigation_counter') | float(0))  -\n      (states('input_number.irrigation_counter_check')
        | float(0)) < 1 }}"
    then:
    - service: input_number.set_value
      data:
        value: 1
      target:
        entity_id: input_number.irrigation_counter
      enabled: true
    else:
    - service: input_number.set_value
      target:
        entity_id: input_number.irrigation_counter
      data:
        value: "{{ (states('sensor.irrigation_unlimited_counter') | float(0))  +\n
          \   (states('input_number.irrigation_counter') | float(0))  -\n  (states('input_number.irrigation_counter_check')
          | float(0)) }}"
    enabled: true
  - service: input_number.set_value
    target:
      entity_id: input_number.irrigation_counter_check
    data:
      value: '{{ int(states(''sensor.irrigation_unlimited_counter''),0) }}'
  mode: single
- id: '1677230846021'
  alias: irrigation_unlimited_count_down
  description: Midnight and noon - minus one for counters
  trigger:
  - platform: time
    at: 00:10:00
  - platform: time
    at: '12:10:00'
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ float(states(''sensor.irrigation_unlimited_temp_max_today''),0)>
        15}}'
    - condition: state
      entity_id: input_boolean.irrigation_state
      state: 'on'
  action:
  - if:
    - condition: template
      value_template: '{{ int(states(''input_number.irrigation_counter''),0) == 1
        }}'
    then:
    - service: input_number.set_value
      data:
        value: '{{ int(states(''input_number.irrigation_counter_check''),0)}}'
      target:
        entity_id: input_number.irrigation_counter
    else:
    - service: input_number.set_value
      data:
        value: '{{ int(states(''input_number.irrigation_counter''),0) - 1 }}'
      target:
        entity_id: input_number.irrigation_counter
  - service: input_number.set_value
    data:
      value: '{{ int(states(''input_number.irrigation_counter''),0) - 1 }}'
    target:
      entity_id: input_number.irrigation_counter
    enabled: false
  mode: single
- id: '1677245580092'
  alias: irrigation_unlimited_finish
  description: Finish irrigation
  trigger:
  - platform: event
    event_type: irrigation_unlimited_finish
  - platform: state
    entity_id:
    - input_button.irrigation_cancel
  condition: []
  action:
  - service: irrigation_unlimited.disable
    data:
      entity_id: binary_sensor.irrigation_unlimited_c1_m
  - service: irrigation_unlimited.disable
    data:
      entity_id: binary_sensor.irrigation_unlimited_c2_m
  - service: notify.admin_mobile
    data:
      message: 'Time: {{ as_local(trigger.event.time_fired).strftime(''%c'') }}

        Controller: {{ trigger.event.data.controller.index + 1 }} {{ trigger.event.data.controller.name
        }}

        Sequence: {{ trigger.event.data.sequence.index + 1 }} {{ trigger.event.data.sequence.name
        }}

        Schedule: {% if trigger.event.data.schedule.index is integer %}{{ trigger.event.data.schedule.index
        + 1 }} {{ trigger.event.data.schedule.name }}{% else %} Manual {% endif %}

        Duration: {{ timedelta(seconds=trigger.event.data.run.duration) }} irrigation
        done

        '
  mode: single
- id: '1677246213813'
  alias: irrigation_unlimited_run
  description: enable irrigation
  trigger:
  - platform: state
    entity_id:
    - input_number.irrigation_counter
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.irrigation_state
      state: 'on'
    - condition: template
      value_template: '{{ int(states(''input_number.irrigation_counter''),0) == 1}}'
    - condition: template
      value_template: '{{ float(states(''sensor.irrigation_unlimited_temp_max_today''),0)>
        15}}'
    - condition: template
      value_template: '{{ int(states(''sensor.irrigation_unlimited_rain_ajastment''),0)>
        0}}'
  action:
  - if:
    - condition: time
      after: 00:01:00
      before: '12:01:00'
    then:
    - service: irrigation_unlimited.enable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c1_m
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c1_m
        percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
          float(-2) %}  {{ (rain_adj) }}

          '
    else:
    - service: irrigation_unlimited.enable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c2_m
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c2_m
        percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
          float(-2) %}  {{ (rain_adj) }}

          '
  mode: single
- id: '1681721042877'
  alias: temp_control_rooms
  description: Control temperature of thermostats in rooms depend on outside temp
  trigger:
  - platform: state
    entity_id:
    - sensor.rooms_temp_settler
  - platform: state
    entity_id:
    - input_number.guestroom_refine_temp
  - platform: state
    entity_id:
    - input_number.bedroom_refine_temp
  - platform: state
    entity_id:
    - input_number.childrenroom_refine_temp
  - platform: time_pattern
    hours: /1
    enabled: false
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.temperature_control
      state: 'on'
    - condition: template
      value_template: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.guestroom_refine_temp''),0))
        != float(state_attr(''climate.01guestroom'', ''temperature''),0)

        or

        (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.bedroom_refine_temp''),0))
        != float(state_attr(''climate.02bedroom'', ''temperature''),0)

        or

        (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.childrenroom_refine_temp''),0))
        != float(state_attr(''climate.02childrenroom'', ''temperature''),0)

        }}'
  action:
  - if:
    - condition: template
      value_template: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.guestroom_refine_temp''),0))
        != float(state_attr(''climate.01guestroom'', ''temperature''),0)}}'
    then:
    - service: climate.set_temperature
      data:
        temperature: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.guestroom_refine_temp''),0))
          }}'
      target:
        entity_id: climate.01guestroom
  - if:
    - condition: template
      value_template: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.childrenroom_refine_temp''),0))
        != float(state_attr(''climate.02childrenroom'', ''temperature''),0)}}'
    then:
    - service: climate.set_temperature
      data:
        temperature: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.childrenroom_refine_temp''),0))
          }}'
      target:
        entity_id: climate.02childrenroom
  - if:
    - condition: template
      value_template: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.bedroom_refine_temp''),0))
        != float(state_attr(''climate.02bedroom'', ''temperature''),0)}}'
    then:
    - service: climate.set_temperature
      data:
        temperature: '{{ (float(states(''sensor.rooms_temp_settler''),0)+float(states(''input_number.bedroom_refine_temp''),0))
          }}'
      target:
        entity_id: climate.02bedroom
  mode: single
- id: '1683318245786'
  alias: 'irrigation_unlimited_adjustment '
  description: Adjast enabled irrigation
  trigger:
  - platform: state
    entity_id:
    - sensor.irrigation_unlimited_rain_ajastment
    for:
      hours: 0
      minutes: 20
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.irrigation_state
      state: 'on'
  action:
  - if:
    - condition: template
      value_template: '{{float(states(''sensor.irrigation_unlimited_rain_ajastment'',0))==0}}'
      alias: Disable everything as rain
    then:
    - service: irrigation_unlimited.disable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c3_m
    - service: irrigation_unlimited.disable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c2_m
    - service: irrigation_unlimited.disable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c1_m
    else:
    - service: irrigation_unlimited.enable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c3_m
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c3_m
        percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
          float(-2) %}  {{ (rain_adj) }}

          '
    - if:
      - condition: template
        value_template: "{{ float(states('input_number.irrigation_counter_check'),0)
          == 1 }}\t\t"
      then:
      - choose:
        - conditions:
          - condition: time
            after: 00:01:00
            before: '12:01:00'
          sequence:
          - service: irrigation_unlimited.enable
            data:
              entity_id: binary_sensor.irrigation_unlimited_c1_m
          - service: irrigation_unlimited.adjust_time
            data:
              entity_id: binary_sensor.irrigation_unlimited_c1_m
              percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
                float(-2) %}  {{ (rain_adj) }}

                '
        - conditions:
          - condition: time
            after: '12:01:00'
            before: 00:01:00
          sequence:
          - service: irrigation_unlimited.enable
            data:
              entity_id: binary_sensor.irrigation_unlimited_c2_m
          - service: irrigation_unlimited.adjust_time
            data:
              entity_id: binary_sensor.irrigation_unlimited_c2_m
              percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
                float(-2) %}  {{ (rain_adj) }}

                '
      alias: Enable irrigation with conditions
  mode: single
- id: '1683988415783'
  alias: irrigation_water_drop
  description: enable\disable watering drop irrigation
  trigger:
  - platform: state
    entity_id:
    - input_boolean.irrigation_state
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition: []
  action:
  - if:
    - condition: template
      value_template: '{{ states(''input_boolean.irrigation_state'')== ''on''}}'
    then:
    - service: irrigation_unlimited.enable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c3_m
    else:
    - service: irrigation_unlimited.disable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c3_m
    enabled: true
  mode: single
- id: '1685019185477'
  alias: irrigation_unlimited_today
  description: enable irrigation
  trigger:
  - platform: state
    entity_id:
    - input_button.irrigation_today
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.irrigation_state
      state: 'on'
    - condition: template
      value_template: '{{ int(states(''input_number.irrigation_counter''),0) == 1}}'
      enabled: false
    - condition: template
      value_template: '{{ float(states(''sensor.irrigation_unlimited_temp_max_today''),0)>
        15}}'
    - condition: template
      value_template: '{{ int(states(''sensor.irrigation_unlimited_rain_ajastment''),0)>
        0}}'
      enabled: false
  action:
  - if:
    - condition: time
      after: 00:01:00
      before: '12:01:00'
    then:
    - service: irrigation_unlimited.enable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c1_m
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c1_m
        percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
          float(-2) %}  {{ (rain_adj) }}

          '
      enabled: false
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c1_m
        percentage: 100
    else:
    - service: irrigation_unlimited.enable
      data:
        entity_id: binary_sensor.irrigation_unlimited_c2_m
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c2_m
        percentage: '{% set rain_adj = states(''sensor.irrigation_unlimited_rain_ajastment'')|
          float(-2) %}  {{ (rain_adj) }}

          '
      enabled: false
    - service: irrigation_unlimited.adjust_time
      data:
        entity_id: binary_sensor.irrigation_unlimited_c2_m
        percentage: 100
  mode: single
